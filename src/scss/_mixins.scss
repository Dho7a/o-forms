////
/// @group o-forms
/// @link http://registry.origami.ft.com/components/o-forms
////

/// Common field styles
@mixin oFormsCommonField {
	box-sizing: border-box;
	-moz-appearance: none;
	-webkit-appearance: none;
	margin: 0;
	height: $_o-forms-field-default-height;
	border: $_o-forms-fieldborder;
	border-radius: $_o-forms-field-borderradius;
	padding: $_o-forms-field-default-padding-top $_o-forms-field-default-padding-leftright $_o-forms-field-default-padding-bottom;
	width: 100%;
	background-color: oColorsGetColorFor(o-forms-field-standard, background);
	color: oColorsGetColorFor(o-forms-field-standard, text);
	font-family: $o-forms-font-family;
	font-size: $_o-forms-field-default-fontsize;
	outline: none;
	transition: 0.15s box-shadow ease-in;
	background-clip: padding-box;

	&:focus {
		@include oFormsCommonFieldFocus;
	}
	&:disabled {
		@include oFormsCommonFieldDisabled;
	}
}

/// Common field styles: small
@mixin oFormsCommonSmall {
	font-size: $_o-forms-field-small-fontsize;
	padding-top: 0;
	padding-bottom: 0;
	background-size: $_o-forms-select-small-iconsize;
	height: $_o-forms-field-small-height;
	line-height: $_o-forms-field-small-height - ($_o-forms-fieldborder-width * 2);
}

/// Common field styles: focused state only
@mixin oFormsCommonFieldFocus {
	@include oColorsFor(o-forms-field-focus);
	box-shadow: inset 0 0 4px 1px oColorsGetColorFor(o-forms-focus-ring, border);
}

/// Common field styles: disabled state
@mixin oFormsCommonFieldDisabled {
	cursor: default;
	color: mix(oColorsGetColorFor(o-forms-field-standard, background), oColorsGetColorFor(o-forms-field-standard, text), 70%);
	border-color: mix(oColorsGetColorFor(o-forms-field-standard, background), oColorsGetColorFor(o-forms-field-standard, border), 50%);
	background-color: mix(oColorsGetColorFor(o-forms-field-standard, background), oColorsGetColorFor(o-forms-field-standard, border), 85%);
}

/// Common field styles: invalid state
@mixin oFormsCommonFieldInvalid {
	@include oColorsFor(o-forms-field-invalid);

	&:focus {
		box-shadow: inset 0 0 4px 1px rgba(oColorsGetColorFor(o-forms-field-invalid, border), 0.3);
	}
}

/// Common field styles: valid state
@mixin oFormsCommonFieldValid {
	border-color: oColorsGetColorFor(o-forms-field-valid, border);
}

/// Unskin a field entirely, but keep its structure intact
@mixin oFormsUnskin {
	// scss-lint:disable ImportantRule
	-moz-appearance: none !important;
	-webkit-appearance: none !important;
	border: 0 !important;
	background-color: transparent !important;
	padding-left: 0 !important;
	padding-right: 0 !important;
	box-shadow: none !important;

	// for iOS
	-webkit-text-fill-color: #333333 !important;
	opacity: 1 !important;
	border-radius: 0 !important;
}

/// Select styles
///
/// To be used in combination with oFormsCommonField
@mixin oFormsSelect {
	cursor: pointer;
	$icon-color: oColorsGetPaletteColor('grey-tint5');
	color: oColorsGetPaletteColor('grey-tint5');
	$icon-url: str-replace("https://www.ft.com/__origami/service/image/v2/images/raw/fticon-v1:arrows-up-down?source=o-icons&tint=%23#{$icon-color},%23#{$icon-color}&format=svg", "#", "");
	background-image: url($icon-url);
	// scss-lint:disable DuplicateProperty
	background-position: right center; // For iOS 6 that doesn't support 4-value background-position
	background-position: right $_o-forms-field-default-padding-leftright center;
	// scss-lint:enable DuplicateProperty
	background-repeat: no-repeat;
	background-origin: border-box;
	background-size: $_o-forms-select-iconsize;
	padding-right: $_o-forms-select-iconsize + $_o-forms-field-default-padding-leftright;
	padding-top: $_o-forms-field-default-padding-bottom - 2px;

	// Normalise line-height across browsers,
	// which makes sure bottom of glyps are visible in Firefox in particular
	line-height: 110%;

	// Improve readability of descending glpys in old IE
	padding-bottom: #{$_o-forms-field-default-padding-bottom - 2px}\9;

	// In old IE, since we can't hide the stock browser arrow, we'll just keep it:
	// 1. Remove additional padding
	// 2. Remove the custom arrow
	// scss-lint:disable DuplicateProperty
	padding-right: #{$_o-forms-field-default-padding-leftright}\9; // [1]
	background-image: none\9; // [2]
	// scss-lint:enable DuplicateProperty

	// Hide stock browser select arrow in Firefox
	text-indent: 0.01px;
	text-overflow: '';

	// Hide stock browser arrow in IE 10+
	&::-ms-expand {
		display: none;
		color: oColorsGetPaletteColor('white');
	}
}

/// Textarea styles
@mixin oFormsTextarea {
	vertical-align: top;
	resize: vertical;
	height: auto;
	min-height: $_o-forms-field-default-height;
}

/// Label styles
@mixin oFormsLabel {
	display: block;
	margin-bottom: $_o-forms-label-marginbottom;
	font-size: 16px;
	line-height: 19px;
	font-weight: bold;
	color: oColorsGetColorFor(o-forms-field-label body, text);

	p {
		margin-top: 0;

		&:last-child {
			margin-bottom: 0;
		}
	}
}

/// Group styles
@mixin oFormsGroup {
	position: relative;
	margin-bottom: 20px;

	@include _oFormsBreakpoint {
		padding-right: $_o-forms-group-padding;
		padding-left: $_o-forms-group-padding;
	}
}

/// Additional info
@mixin oFormsAdditionalInfo {
	display: block;
	margin-top: -2px;
	margin-bottom: 4px;
	color: oColorsGetColorFor(o-forms-field-additional-info body, text);
	font-size: 12px;
	line-height: 15px;
}

/// Error text
@mixin oFormsErrorText {
	clear: both;
	display: block;
	margin-top: -1px;
	padding: 3px 5px;
	font-family: $o-forms-font-family;
	font-size: 14px;
	color: oColorsGetColorFor(o-forms-field-invalid, text);
}

/// Zone wrapper
@mixin oFormsWrapper {
	margin-bottom: 20px;
	margin-right: $_o-forms-group-padding * -1;
	margin-left: $_o-forms-group-padding * -1;
	padding-right: $_o-forms-group-padding;
	padding-left: $_o-forms-group-padding;

	@include _oFormsBreakpoint {
		border-radius: $_o-forms-field-borderradius;
		margin-right: 0;
		margin-left: 0;
		padding-left: 0;
		padding-right: 0;
	}

	// Clearfix
	zoom: 1;

	&:before,
	&:after {
		content: ' ';
		display: table;
	}
	&:after {
		clear: both;
	}

	&--highlight {
		background-color: oColorsGetColorFor(o-forms-wrapper-highlight, background);
	}
	&--error {
		// scss-lint:disable DuplicateProperty
		background-color: oColorsGetColorFor(o-forms-message-error-fallback, background);
		background-color: rgba(oColorsGetColorFor(o-forms-message-error, background), 0.15);
	}
}

/// Target styles at Internet Explorer 8 only
@mixin _oFormsTargetIE8 {
	@media \0screen {
		@content;
	}
}

/// Target both IE8 and modern browsers at the breakpoint
/// Useful for layout changes at the Small breakpoint
@mixin _oFormsBreakpoint {
	@include oGridRespondTo(S) {
		@content;
	}
	@include oGridTargetIE8 {
		@content;
	}
}

// From: https://css-tricks.com/snippets/sass/str-replace-function/
/// Replace `$search` with `$replace` in `$string`
/// @author Hugo Giraudel
/// @param {String} $string - Initial string
/// @param {String} $search - Substring to replace
/// @param {String} $replace ('') - New value
/// @return {String} - Updated string
@function str-replace($string, $search, $replace: '') {
  $index: str-index($string, $search);

  @if $index {
    @return str-slice($string, 1, $index - 1) + $replace + str-replace(str-slice($string, $index + str-length($search)), $search, $replace);
  }

  @return $string;
}
